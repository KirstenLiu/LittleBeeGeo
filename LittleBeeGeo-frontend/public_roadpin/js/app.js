(function(){"use strict";window.onGoogleReady=function(){return console.log("onGoogleReady: start"),angular.bootstrap(window.document,["LittleBeeGeoFrontend"])},angular.module("LittleBeeGeoFrontend",["ngRoute","ngCookies","ngResource","ui.map","ui.event","ui.bootstrap"]).config(["$routeProvider","$locationProvider"].concat(function(e,o){return e.when("/view1",{templateUrl:"/views/partial1.html"}).when("/view2",{templateUrl:"/views/partial2.html"}).when("/map",{templateUrl:"/views/map.html"}).otherwise({redirectTo:"/map"}),o.html5Mode(!1)}))}).call(this),function(){"use strict";angular.module("LittleBeeGeoFrontend").controller("AppCtrl",["$scope","$location","$resource","$rootScope","version"].concat(function(e,o,t,n,r){return e.version=r,e.$watch(function(){return o.path()},function(t,n){return console.log("$location.path():",o.path(),"active-nav-id:",t,"orig-active-nav-id",n),e.activeNavId=t,e}),e.getClass=function(o){return e.activeNavId===o?"active":""},e.pageTitle="Little Bee Report",e.awesomeThings=["Livescript","AngularJS","Karma","Yo","Bower"]}))}.call(this),function(){"use strict";function e(e,o){var t,n=function(r){return e.length>1?function(){var a=r?r.concat():[];return t=o?t||this:this,a.push.apply(a,arguments)<e.length&&arguments.length?n.call(t,a):e.apply(t,a)}:e};return n()}var o,t,n,r,a,i,l,s,c,u,g,m,p=[].slice;o=require("prelude-ls"),t=o.map,n=o.fold,r=o.fold1,a=o.mean,i=o.join,l=[],s="#0F8",c="report.png",u="#0FF",g="#000",m="img/bee.png",angular.module("LittleBeeGeoFrontend").controller("MapCtrl",["$scope","geoAccelGyro","jsonData","reportList","$modal"].concat(function(o,n,a,l,c){var d,f,v,_,h,L,w,y,k,M,C,S,I,T,G,P,z,$,b,D,B,E,R,A,F,x;return d=n.getGeo(),f={isReport:"no"},o.states=f,o.mapOptions={center:new google.maps.LatLng(d.lat,d.lon),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP},o.zoom=16,v=!0,_={marker:void 0},o.$on("geoAccelGyro:event",function(e,t){return"devicegeo"===t.event?(v&&(console.log("to set is_first_map_center as false"),v=!1,o.myMap.setCenter(new google.maps.LatLng(t.lat,t.lon))),y(t,_)):void 0}),o.$watch(function(){return a.getDataTimestamp()},function(){var e,t,n,r,i,l;e=a.getData(),console.log("Map: the_data:",e),n=[];for(r in e)i=e[r],n.push(i);return t=n,l=G(t),console.log("markers:",l),o.markers=l}),o.onMapIdle=function(){},o.reportMarkers=[],o.onMapClick=function(e,t){var n,r,a,i;return console.log("onMapClick: event:",e,"params:",t),"no"!==f.isReport?(n=e.is_remove_same_point===!1?!1:!0,l.setMarker(t[0],o.zoom,n),r=l.getList(),M(o.reportMarkers),a=C(r,s),i=I(r,u),o.reportMarkers=a.concat(i)):void 0},o.onZoomIn=function(){return console.log("onZoomIn: zoom:",o.zoom),17!==o.zoom?(o.zoom+=1,o.myMap.setZoom(o.zoom)):void 0},o.onZoomOut=function(){return console.log("onZoomIn: zoom:",o.zoom),3!==o.zoom?(o.zoom-=1,o.myMap.setZoom(o.zoom)):void 0},o.onMapZoomChanged=function(e){return console.log("onMapZoomChanged: zoom:",e),o.zoom=e},o.onClearReportList=function(){return console.log("onClearReportList: start"),l.clearList(),M(o.reportMarkers),o.reportMarkers=[]},o.onAddCurrentLocation=function(){var e;if(void 0!==_.marker)return e=_.marker.getPosition(),o.onMapClick({event_type:"onAddCurrentLocation",is_remove_same_point:!1},[{latLng:e}])},h=function(e,o,t){var n;return console.log("SubmitCtrl: start"),n=l.getList(),e.onSubmitOk=function(){return console.log("to submit: items:",t,"report_list:",n)},e.onSubmitCancel=function(){return o.dismiss("cancel")}},o.onSubmit=function(){var e,o,t;return console.log("to open modal instance"),e=c.open({templateUrl:"/views/submit.html",controller:h,resolve:{items:function(){return{}}}}),o=function(e){return console.log("to submit-form: items:",e)},t=function(){return console.log("dismissed: %s",(new Date).toDateString())},e.result.then(o,t)},L=function(){var e,o,t;return e=new google.maps.Point(TILE_SIZE/2,TILE_SIZE/2),o=TILE_SIZE/360,t=TILE_SIZE/(2*Math.PI),{pixel_origin:e,piexls_per_lon_deg:piexls_per_lon_deg,piexls_per_lon_radius:t}},w=function(e){var t,n;return t=o.myMap.getProjection(),n=new google.maps.Point(0,0),n.x=origin.x+latLng.lng(),n=t.fromLatLngToContainerPixel(e)},y=function(e,t){var n,r,a;return n=new google.maps.LatLng(e.lat,e.lon),console.log("position:",n),void 0===t.marker?(r={url:m,size:new google.maps.Size(53,51),scaledSize:new google.maps.Size(25,25),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(12,12)},a={map:o.myMap,position:n,fillColor:g,strokeColor:g,icon:r},t.marker=new google.maps.Marker(a)):t.marker.setPosition(n)},k=function(e){return t(function(e){return e.setMap(o.myMap)})(e)},M=function(e){return console.log("_remove_markers_from_googlemap: markers:",e),t(function(e){return e.setMap(void 0)})(e)},C=function(e,o){return t(function(e){return S(e,o)})(e)},S=function(e,t){var n,r,a,i,l,s,c;console.log("_add_marker_to_googlemap: data:",e,"color:",t),r=[];for(a in i=e.latLng)l=i[a],r.push(l);return n=r,s={map:o.myMap,position:e.latLng,fillColor:t,strokeColor:t},c=new google.maps.Marker(s)},I=function(e,o){var n,r,a,i,l,s,c,u,g,m;if(console.log("_add_marker_paths_to_googlemap_from_markers:",e),e.length<2)return[];for(n=p.call(e,0,-1),r=p.call(e,1,9e9),i=[],l=0,s=n.length-1;s>=l;++l)c=l,i.push(c);for(a=i,i=[],l=0,g=a.length;g>l;++l)m=a[l],i.push({the_marker:n[m],next_marker:r[m]});return u=i,t(function(e){return T(e,o)})(u)},T=function(e,t){var n,r,a;return console.log("data:",e),n=e.the_marker.latLng,r=e.next_marker.latLng,a={map:o.myMap,path:[n,r],fillColor:t,strokeColor:t},new google.maps.Polyline(a)},G=function(o){var t,n,a,i,l,s;for(console.log("_parse_markers: the_data_values:",o),n=[],a=0,i=o.length;i>a;++a)l=o[a],n.push(P(l));for(t=n,n=[],a=0,i=t.length;i>a;++a)s=t[a],void 0!==s&&n.push(s);return t=n,r(e(function(e,o){return e.concat(o)}))(t)},P=function(e){var o,t,n,r,a,i,l,s;if(o=e.geo,void 0!==o){for(t=z(e),console.log("_parse_marker: geo:",o),r=[],a=0,i=o.length;i>a;++a)l=o[a],r.push($(l,t,e));for(n=r,console.log("after _parse_each_marker: markers:",n),a=0,i=n.length;i>a;++a)s=n[a],A(s);return n}},z=function(){return"#840"},$=function(e,o,t){var n,r;switch(n=e.type,r=e.coordinates,console.log("_parse_each_marker: geo:",e,"the_type:",n,"the_coordinates",r),n){case"Polygon":return b(r,o,t);case"LineString":return D(r,o,t);case"Point":return B(r,o,t)}},b=function(e,t,n){var r,a,i;return r={map:o.myMap,paths:function(){var o,t,n,r=[];for(o=0,n=(t=e).length;n>o;++o)a=t[o],r.push(E(a));return r}(),fillColor:t,strokeColor:t},i=new google.maps.Polygon(r),i._value=n,i},D=function(e,t,n){var r,a;return r={map:o.myMap,path:E(e),fillColor:t,strokeColor:t},a=new google.maps.Polyline(r),a._value=n,console.log("_parse_line_string: polyline_opts:",r,"polyline:",a),a},B=function(e,t,n){var r,a;return r={map:o.myMap,position:new google.maps.LatLng(e[1],e[0]),fillColor:t,strokeColor:t},a=new google.maps.Marker(r),a._value=n,a},E=function(e){var o,t,n,r=[];for(console.log("_parse_path: coordinates",e),o=0,t=e.length;t>o;++o)n=e[o],r.push(new google.maps.LatLng(n[1],n[0]));return r},R=new google.maps.InfoWindow({content:"Hello World"}),A=function(e){return console.log("_add_map_listener: start: marker:",e),google.maps.event.addListener(e,"click",function(t){return console.log("map_listener: marker:",e),void 0!==t?(R.setPosition(t.latLng),R.open(o.myMap),R.setContent(F(e._value))):void 0})},F=function(e){var o,t;return o=e.address,void 0!==e.start_number&&(o+=" "+e.start_number+" 號"),void 0!==e.end_number&&(o+=" ~ "+e.end_number+" 號"),t="<div><p>"+x([e.county,e.town])+"</p><p>"+o+"</p><p>"+e.deliver_time+"</p>",t+="</div>"},x=function(e){var o,t,n,r;for(o=[],t=0,n=e.length;n>t;++t)r=e[t],r&&o.push(r);return e=o,i(" / ",e)}}))}.call(this),function(){"use strict";angular.module("LittleBeeGeoFrontend").directive("appVersion",["version"].concat(function(e){return{link:function(o,t){return t.text("the version is"+e)}}}))}.call(this),function(){"use strict";angular.module("LittleBeeGeoFrontend").filter("interpolate",["version"].concat(function(e){return function(o){return String(o).replace(/\%VERSION\%/gm,e)}}))}.call(this),function(){"use strict";angular.module("LittleBeeGeoFrontend").constant("constants",{NUM_QUERY:1001,THRESHOLD_DIST_SAME_POINT:10})}.call(this),function(){"use strict";var e;e={data:{lat:24.5,lon:121.5},data_timestamp:(new Date).getTime()},angular.module("LittleBeeGeoFrontend").factory("geoAccelGyro",["$rootScope","$window"].concat(function(o,t){var n;return console.log("to set send-event"),t.ondeviceorientation=function(e){var t,n,r;return t=e.alpha,n=e.beta,r=e.gamma,o.$apply(function(){return o.$broadcast("geoAccelGyro:event",{event:"deviceorientation",yaw:t,pitch:n,roll:r})})},t.ondevicemotion=function(e){var t,n,r;return t=e.acceleration.x,n=e.acceleration.y,r=e.acceleration.z,o.$apply(function(){return o.$broadcast("geoAccelGyro:event",{event:"devicemotion",move_x:t,move_y:n,move_z:r})})},n=function(t){var n,r,a;return n=t.coords.latitude,r=t.coords.longitude,a=e.data,a.lat=n,a.lon=r,e.data_timestamp=(new Date).getTime(),console.log("got currentPosition: position:",t),o.$apply(function(){return o.$broadcast("geoAccelGyro:event",{event:"devicegeo",lat:n,lon:r})})},navigator.geolocation.watchPosition(n),{getGeo:function(){return e.data},getDataTimestamp:function(){return e.data_timestamp}}}))}.call(this),function(){"use strict";function e(e,o){var t={}.hasOwnProperty;for(var n in o)t.call(o,n)&&(e[n]=o[n]);return e}var o,t,n,r,a,i;o=require("prelude-ls"),t=o.initial,n=o.last,r=window.LittleBeeGeo.CONFIG,a={data:{},data_timestamp:(new Date).getTime()},i=!0,angular.module("LittleBeeGeoFrontend").factory("jsonData",["$resource","constants"].concat(function(o,l){return{getDataTimestamp:function(){return a.data_timestamp},getData:function(){var s,c,u,g,m;return i?(i=!1,s="http://"+r.BACKEND_HOST+"/get/json",c=l.NUM_QUERY,a.data,u=function(o,r){var i,l,s,u,m,p,d,f;for(console.log("the_data:",o,"getResponseHeaders:",r()),i=o.length===c?t(o):o,s={},u=0,m=i.length;m>u;++u)p=i[u],s[p.the_id]=p;return l=s,e(a.data,l),a.data_timestamp=(new Date).getTime(),o.length===c?(d=n(o),console.log("last_data:",d),f=d.json_id,console.log("next_id:",f,"last_data:",d),g(f)):void 0},g=function(e){var t;return t=o(s),t.query({num_query:c,next_id:e},u)},m=o(s),m.query({num_query:c},u),a.data):a.data}}}))}.call(this),function(){"use strict";var e,o,t,n,r,a,i;e=require("prelude-ls"),o=e.map,t=e.filter,n=e.head,r=e.sortWith,a={data:[]},i=[262144,131072,65536,32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1],angular.module("LittleBeeGeoFrontend").service("reportList",["constants"].concat(function(e){var o,l;return console.log("constants:",e),o=function(e,o){return google.maps.geometry.spherical.computeDistanceBetween(e.latLng,o.latLng)},l=function(a,l,s,c){var u,g,m,p,d,f;return void 0!==l.data&&l.data.length?(console.log("the_list.data.length:",l.data.length),u=function(e,t){return o(e,a)-o(t,a)},g=n(r(u)(l.data)),m=o(g,a),p=e.THRESHOLD_DIST_SAME_POINT*i[s],console.log("min_diff_by_latlon_data:",g,"min_diff_by_latlon:",m,"threshold_dist_same_point:",p),m>p?a:(c&&(d=function(e){return o(e,a)>m},l.data=t(d)(l.data),console.log("after remove_data: the_list:",l)),f=c?void 0:g)):a},{setMarker:function(e,o,t){var n;return null==t&&(t=!0),n=l(e,a,o,t),void 0!==n&&(a.data=a.data.concat([n])),console.log("after setMarker: params:",e,"the_marker:",n,"cache_list.data:",a.data)},getList:function(){return a.data},clearList:function(){return a.data=[]}}}))}.call(this),function(){"use strict";angular.module("LittleBeeGeoFrontend").factory("version",[].concat(function(){return.1}))}.call(this);